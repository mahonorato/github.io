(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{438:function(n,r,e){"use strict";e.r(r);var a=e(42),o=Object(a.a)({},(function(){var n=this.$createElement,r=this._self._c||n;return r("ContentSlotsDistributor",{attrs:{"slot-key":this.$parent.slotKey}},[r("h2",{attrs:{id:"modelo-de-dados"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#modelo-de-dados"}},[this._v("#")]),this._v(" Modelo de Dados")]),this._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[this._v("Notas - Ocorrências\n    Ao verificar o tipo de resultado\n        Os resultados são ponderados pela tabela TIPO_RESULTADO_INSP_PESO\n        -- Verificando somente na Resultado VISITA (Correto)\n")])])]),r("div",{staticClass:"language-{SQL} extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[this._v("SELECT nvl(trim(r.ind_fraude), 'Outro') TIPO_FRAUDE, COUNT(R.COD_NOTA ) qtd\nFROM prj_cicop.resultado_visita R\ngroup by nvl(trim(r.ind_fraude), 'Outro')\nORDER BY 1 NULLS LAST;\n")])])]),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[this._v("            /*\n                TIPO_COD        QTD\n                CA          151.745 -- Cancelado\n                FR          893.594\n                IR          310.783\n                LF          722.861\n                NA        1.257.520\n                NI          645.776\n                Total      3.982.279\n            */\n        -- Verificando somente na Resultado VISITA com TIPO_RESULTADO_INSP_PESO (Errado)\n            SELECT nvl(trim(r.ind_fraude), 'Outro') TIPO_FRAUDE, COUNT(v.COD_NOTA ) qtd\n            FROM prj_cicop.resultado_visita V\n                ,prj_cicop.tipo_resultado_insp_PESO R\n            WHERE v.resultado = r.resultado\n            group by nvl(trim(r.ind_fraude), 'Outro')\n            ORDER BY 1 NULLS LAST;\n            /*\n                TIPO_FRAUDE  QTD\n                CA          151.745\n                FR          333.688\n                IR          870.681\n                LF          722.861\n                NA        1.257.527\n                NI          645.777\n                    3.982.279\n            */\n        -- Verificando somente na Resultado VISITA com TIPO_RESULTADO_INSP_PESO\n            SELECT trim(v.ind_fraude) TF_VISITA,\n                trim(r.ind_fraude) TF_resultado_peso,\n                COUNT(v.COD_NOTA ) qtd\n            FROM prj_cicop.resultado_visita V\n                ,prj_cicop.tipo_resultado_insp_PESO R\n            WHERE v.resultado = r.resultado\n            group by trim(v.ind_fraude),trim(r.ind_fraude)\n            ORDER BY 1 NULLS LAST;\n            /*\n                VISITA RESULTADO_PESO     QTD\n                FR     FR             333.635\n                FR     IR             559.954\n                FR     NI                   1\n                FR     NA                   4\n                --\n                IR     IR             310.727\n                IR     FR                  53\n                IR     NA                   3\n                --\n                CA     CA             151.745\n                LF     LF             722.861\n                NA     NA           1.257.520\n                NI     NI             645.776\n            */\n        -- Validação da regra de PESO\n            SELECT trim(v.ind_fraude) TF_VISITA,\n                trim(r.ind_fraude) TF_resultado_peso, v.COD_NOTA\n            FROM prj_cicop.resultado_visita V\n                ,prj_cicop.tipo_resultado_insp_PESO R\n            WHERE v.resultado = r.resultado\n                and v.ind_fraude = 'FR'\n                and r.ind_fraude = 'NA'\n            ORDER BY 1 NULLS LAST;\n        -- Validação da regra de PESO\n            select cod_nota, num_seq, id_cdc, maior_peso, maior_resultado as resultado,\n                case when menor_resultado in ('ATIRREGT01','ATIRREGT02')\n                    then menor_ind_fraude\n                else maior_ind_fraude end ind_fraude,\n                maior_descricao,\n                case   when (menor_resultado in ('ATIRREGT01','ATIRREGT02') or maior_ind_fraude in ('FR','IR'))\n                    then rank() over (partition by cod_nota order by maior_peso desc, num_seq desc)\n                    else 0\n                end as num_rank\n                ,maior_ind_fraude ind_fraude_T2\n            from (select r2.cod_nota, id_cdc, r2.num_seq,\n                t2.peso maior_peso,\n                r2.resultado maior_resultado,\n                t2.descricao maior_descricao,\n                t2.ind_fraude maior_ind_fraude,\n                first_value(r2.resultado)  over (partition by cod_nota, num_seq order by peso    asc  nulls last) menor_resultado,\n                first_value(t2.ind_fraude) over (partition by cod_nota, num_seq order by peso    asc  nulls last) menor_ind_fraude,\n                row_number()               over (partition by cod_nota, num_seq order by peso    desc nulls last) linha\n                from prj_cicop.resultado_insp r2\n                join prj_cicop.tipo_resultado_insp_peso t2 on r2.resultado = t2.resultado\n                join (select id_cdc\n                    from ri_energy_light.cdc\n                    where id_grupo = 'B') c on to_number(instalacao) = c.id_cdc\n                where t2.peso is not null\n                    and r2.cod_nota in ('010038043630','010038857200','010014647978','010037287578'))\n            -- where linha = 1\n")])])])])}),[],!1,null,null,null);r.default=o.exports}}]);